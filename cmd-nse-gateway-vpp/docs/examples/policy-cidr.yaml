# IP网关策略配置示例 - CIDR网段配置
#
# 使用场景：
# - 展示不同CIDR子网掩码的使用方法
# - 理解CIDR网段的覆盖范围
# - 学习如何合并多个IP为CIDR网段
#
# 应用此配置：
#   export NSM_IP_POLICY_CONFIG_PATH=/path/to/policy-cidr.yaml
#   或在Kubernetes中通过ConfigMap挂载

# 允许列表（白名单）
# 展示不同CIDR子网掩码的使用
allowList:
  # /8 - 大型网段（1677万个IP地址）
  # 格式：x.0.0.0/8，覆盖 x.0.0.0 ~ x.255.255.255
  - "10.0.0.0/8"          # 完整的10.x.x.x私有网段

  # /12 - 中型网段（104万个IP地址）
  # 格式：172.16.0.0/12，覆盖 172.16.0.0 ~ 172.31.255.255
  - "172.16.0.0/12"       # 172.16-31.x.x私有网段

  # /16 - 典型局域网（65536个IP地址）
  # 格式：192.168.0.0/16，覆盖 192.168.0.0 ~ 192.168.255.255
  - "192.168.0.0/16"      # 完整的192.168.x.x私有网段

  # /24 - 小型局域网（256个IP地址）
  # 格式：203.0.113.0/24，覆盖 203.0.113.0 ~ 203.0.113.255
  - "203.0.113.0/24"      # C类网络示例

  # /28 - 微型子网（16个IP地址）
  # 格式：198.51.100.0/28，覆盖 198.51.100.0 ~ 198.51.100.15
  - "198.51.100.0/28"     # 适用于小型设备组

  # /30 - 点对点链路（4个IP地址）
  # 格式：192.0.2.0/30，覆盖 192.0.2.0 ~ 192.0.2.3
  - "192.0.2.0/30"        # 典型点对点链接

  # /32 - 单个IP地址（1个IP地址）
  # 格式：单个精确IP地址
  - "8.8.8.8/32"          # Google DNS服务器（显式/32）
  - "1.1.1.1"             # Cloudflare DNS（自动转为/32）

# 禁止列表（黑名单）
# 即使在白名单大网段内，这些特定IP或子网也会被拒绝
denyList:
  # 拒绝特定子网（在10.0.0.0/8大网段内）
  - "10.1.0.0/16"         # 拒绝整个10.1.x.x子网（65536个IP）

  # 拒绝更小的子网
  - "10.2.3.0/24"         # 拒绝10.2.3.0-255子网（256个IP）

  # 拒绝单个IP
  - "192.168.1.100"       # 拒绝特定设备（自动转为/32）
  - "172.16.5.50/32"      # 拒绝特定设备（显式/32）

# 默认动作
defaultAction: "deny"     # 默认拒绝（安全模式）

# ===== CIDR子网掩码参考表 =====
#
# | CIDR | 子网掩码           | IP数量          | 典型用途             |
# |------|-------------------|-----------------|---------------------|
# | /8   | 255.0.0.0         | 16,777,216      | A类网络（企业大型内网） |
# | /12  | 255.240.0.0       | 1,048,576       | 中型企业网络          |
# | /16  | 255.255.0.0       | 65,536          | B类网络（校园网）     |
# | /24  | 255.255.255.0     | 256             | C类网络（部门局域网）  |
# | /28  | 255.255.255.240   | 16              | 小型设备组           |
# | /30  | 255.255.255.252   | 4               | 点对点链路           |
# | /32  | 255.255.255.255   | 1               | 单个IP地址           |
#
# ===== 匹配示例 =====
#
# 假设使用此配置，以下是一些IP的匹配结果：
#
# 1. 源IP: 10.5.6.7
#    - 匹配allowList: ✅ 10.0.0.0/8（在大型私有网段中）
#    - 匹配denyList: ❌ 无
#    - 结果: ✅ 允许
#
# 2. 源IP: 10.1.2.3
#    - 匹配allowList: ✅ 10.0.0.0/8
#    - 匹配denyList: ✅ 10.1.0.0/16（黑名单优先！）
#    - 结果: ❌ 拒绝（黑名单优先）
#
# 3. 源IP: 192.168.1.100
#    - 匹配allowList: ✅ 192.168.0.0/16
#    - 匹配denyList: ✅ 192.168.1.100/32（精确匹配）
#    - 结果: ❌ 拒绝（黑名单优先）
#
# 4. 源IP: 8.8.8.8
#    - 匹配allowList: ✅ 8.8.8.8/32（精确匹配）
#    - 匹配denyList: ❌ 无
#    - 结果: ✅ 允许
#
# 5. 源IP: 100.64.0.1
#    - 匹配allowList: ❌ 无
#    - 匹配denyList: ❌ 无
#    - 结果: ❌ 拒绝（应用defaultAction: deny）
#
# ===== 最佳实践 =====
#
# 1. 优先使用CIDR网段而非逐个列举IP：
#    ❌ 不推荐:
#      allowList:
#        - "192.168.1.1"
#        - "192.168.1.2"
#        - "192.168.1.3"
#        - ... (254个IP)
#
#    ✅ 推荐:
#      allowList:
#        - "192.168.1.0/24"  # 一条规则覆盖256个IP
#
# 2. 使用黑名单在大网段中排除特定子网：
#    allowList:
#      - "10.0.0.0/8"        # 允许整个10.x.x.x网段
#    denyList:
#      - "10.99.0.0/16"      # 排除10.99.x.x测试网段
#
# 3. 验证CIDR计算：
#    使用在线工具验证CIDR覆盖范围
#    - https://www.ipaddressguide.com/cidr
#    - ipcalc命令：ipcalc 192.168.1.0/24
#
# 4. 避免过大的CIDR网段（除非必要）：
#    ❌ 不推荐（过于宽松）:
#      allowList:
#        - "0.0.0.0/0"       # 允许所有IP（等同于无防护）
#
#    ✅ 推荐（精确控制）:
#      allowList:
#        - "10.0.0.0/8"      # 仅允许内网
#        - "172.16.0.0/12"
#        - "192.168.0.0/16"
